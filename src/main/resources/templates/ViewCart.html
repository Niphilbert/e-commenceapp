<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="ISO-8859-1">
	<title>Customer Cart</title>
	<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			document.getElementById("payBtn").onclick = function() {
				document.getElementById("paymentModal").style.display = "block";
			};

			document.getElementsByClassName("close")[0].onclick = function() {
				document.getElementById("paymentModal").style.display = "none";
			};

			window.onclick = function(event) {
				if (event.target == document.getElementById("paymentModal")) {
					document.getElementById("paymentModal").style.display = "none";
				}
			};

			document.getElementById("clearCartBtn").onclick = function() {
				fetch("/customer/clear-cart", {
					method: "POST"
				})
						.then(response => {
							if (response.ok) {
								window.location.href = "/customer/fetch-cart";
							} else {
								alert("Failed to clear the cart. Please try again.");
							}
						})
						.catch(error => {
							console.error("Error:", error);
							alert("Failed to clear the cart. Please try again.");
						});
			}
		});

	</script>
</head>

<body class="font-sans bg-gray-100 text-gray-800 min-h-screen flex flex-col">

<!-- Navbar -->
<header class="bg-gray-800 shadow py-4 fixed w-full top-0 z-50">
	<div class="container mx-auto flex justify-between items-center px-4">
		<div class="text-2xl font-bold text-white">Phill_store</div>
		<nav class="space-x-4">
			<a href="/customer/home" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-300">Customer Home</a>
			<a href="/customer/fetch-cart" class="bg-green-500 text-white py-2 px-4 rounded hover:bg-green-700 transition duration-300">View Cart</a>
			<a href="/customer/fetch-orders" class="bg-yellow-500 text-white py-2 px-4 rounded hover:bg-yellow-700 transition duration-300">View Orders</a>
			<a href="/logout" class="bg-red-500 text-white py-2 px-4 rounded hover:bg-red-700 transition duration-300">Logout</a>
		</nav>
	</div>
</header>

<!-- Messages -->
<div class="container mx-auto text-center mt-24">
	<h2 class="message text-green-500 text-2xl mb-4" th:text="${pass}"></h2>
	<h3 class="message text-red-500 text-2xl mb-4" th:text="${fail}"></h3>
</div>

<!-- Main Content -->
<main class="container mx-auto text-center mt-10 flex-grow">
	<h1 class="text-4xl font-bold text-gray-800 mb-6">Cart Items</h1>
	<table class="w-full max-w-6xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden">
		<thead>
		<tr class="bg-gray-800 text-white">
			<th class="py-3 px-4">Name</th>
			<th class="py-3 px-4">Picture</th>
			<th class="py-3 px-4">Category</th>
			<th class="py-3 px-4">Price</th>
			<th class="py-3 px-4">Quantity</th>
			<th class="py-3 px-4">Amount</th>
		</tr>
		</thead>
		<tbody>
		<tr class="border-b border-gray-200" th:each="item:${cart.items}">
			<td class="py-3 px-4" th:text="${item.name}"></td>
			<td class="py-3 px-4"><img th:src="@{'data:image/jpeg;base64,'+${item.generateBase64Image()}}" alt="Product Image" class="w-24 h-24 object-cover rounded"></td>
			<td class="py-3 px-4" th:text="${item.category}"></td>
			<td class="py-3 px-4">
				<span th:text="'$' + (${item.price / item.quantity})"></span>
			</td>
			<td class="py-3 px-4" th:text="${item.quantity}"></td>
			<td class="py-3 px-4">
				<span th:text="'$' + ${item.price}"></span>
			</td>
		</tr>
		<tr class="font-bold bg-gray-100">
			<td colspan="5" class="py-3 px-4 text-right">Total Amount:</td>
			<td class="py-3 px-4" th:text="'$' + ${cart.totalAmount}"></td>
		</tr>
		</tbody>
	</table>
</main>

<!-- Action Buttons -->
<div class="container mx-auto text-center mt-10 mb-10">
	<button id="payBtn" class="bg-blue-500 text-white py-3 px-6 rounded hover:bg-blue-700 transition duration-300">Pay</button>
	<button id="clearCartBtn" class="bg-red-500 text-white py-3 px-6 rounded hover:bg-red-700 transition duration-300">Clear Cart</button>
	<a href="/customer/home" class="inline-block mt-4">
		<button class="bg-gray-800 text-white py-3 px-6 rounded hover:bg-gray-900 transition duration-300">Back</button>
	</a>
</div>

<!-- Payment Modal -->
<div id="paymentModal" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
	<div class="modal-content bg-white p-8 rounded-lg shadow-lg w-full max-w-md mx-auto">
		<span class="close text-gray-500 hover:text-gray-800 text-3xl font-bold cursor-pointer">&times;</span>
		<h2 class="text-2xl font-bold mb-6">Payment Information</h2>
		<form action="/customer/payment-complete" method="post" onsubmit="return processPayment()">
			<input type="text" name="card_number" placeholder="Card Number" class="w-full px-3 py-2 border rounded mb-4 focus:outline-none focus:border-blue-500" required>
			<input type="text" name="card_holder" placeholder="Card Holder" class="w-full px-3 py-2 border rounded mb-4 focus:outline-none focus:border-blue-500" required>
			<input type="text" name="expiry_date" placeholder="Expiry Date (MM/YY)" class="w-full px-3 py-2 border rounded mb-4 focus:outline-none focus:border-blue-500" required>
			<input type="text" name="cvv" placeholder="CVV" class="w-full px-3 py-2 border rounded mb-4 focus:outline-none focus:border-blue-500" required>
			<input type="hidden" name="payment_id" id="payment_id">
			<input type="hidden" name="order_id" id="order_id">
			<button type="submit" class="bg-green-500 text-white py-2 px-4 rounded hover:bg-green-700 transition duration-300">Submit Payment</button>
		</form>
	</div>
</div>

<script>
	function processPayment() {
		const paymentId = "PAY" + new Date().getTime();
		const orderId = "ORD" + new Date().getTime();
		document.getElementById("payment_id").value = paymentId;
		document.getElementById("order_id").value = orderId;

		// Submit the form
		return true;
	}
</script>

<!-- Footer -->
<footer class="bg-gray-800 text-white text-center py-6 mt-10">
	<p>&copy; 2024 Phill_sore. All rights reserved.</p>
	<p>
		<a href="/privacy-policy" class="text-blue-400 hover:underline mx-2">Privacy Policy</a>
		<a href="/terms-of-service" class="text-blue-400 hover:underline mx-2">Terms of Service</a>
	</p>
</footer>

</body>

</html>
